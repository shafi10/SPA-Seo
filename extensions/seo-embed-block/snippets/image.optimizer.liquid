<!-- Initial alt text selction logic - start -->
{% liquid
  assign alt_text = 'alt text'
  if request.page_type == 'product'
    assign alt_text = settings.altText.product
  elsif request.page_type == 'collection'
    assign alt_text = settings.altText.collection
  elsif request.page_type == 'article'
    assign alt_text = settings.altText.article
  endif
%}
<!-- Initial alt text selction logic - end -->

<!-- - Liquid translation layer - start -->
{% liquid
  assign product_title = product.title
  assign product_type = product.type
  assign product_vendor = product.vendor
  assign product_tags = product.tags | join: ','

  assign collection_title = collection.title

  assign article_title = article.title
  assign article_author = article.author
  assign article_tags = article.tags | join: ','

  assign shop_name = shop.name
  assign shop_domain = shop.domain
%}

<!-- Capture the raw liquid syntax - start -->

{% capture product_title_code %}{% raw %}{{ product.title }}{% endraw %}{% endcapture %}
{% capture product_type_code %}{% raw %}{{ product.type }}{% endraw %}{% endcapture %}
{% capture product_vendor_code %}{% raw %}{{ product.vendor }}{% endraw %}{% endcapture %}
{% capture product_tags_code %}{% raw %}{{ product.tags }}{% endraw %}{% endcapture %}
{% capture collection_title_code %}{% raw %}{{ collection.title }}{% endraw %}{% endcapture %}
{% capture article_title_code %}{% raw %}{{ article.title }}{% endraw %}{% endcapture %}
{% capture article_author_code %}{% raw %}{{ article.author }}{% endraw %}{% endcapture %}
{% capture article_tags_code %}{% raw %}{{ article.tags }}{% endraw %}{% endcapture %}
{% capture shop_name_code %}{% raw %}{{ shop.name }}{% endraw %}{% endcapture %}
{% capture shop_domain_code %}{% raw %}{{ shop.domain }}{% endraw %}{% endcapture %}

<!-- Capture the raw liquid syntax - end -->

{% liquid
  assign alt_text = alt_text | replace: product_title_code, product_title
  assign alt_text = alt_text | replace: product_type_code, product_type
  assign alt_text = alt_text | replace: product_vendor_code, product_vendor
  assign alt_text = alt_text | replace: product_tags_code, product_tags

  assign alt_text = alt_text | replace: collection_title_code, collection_title

  assign alt_text = alt_text | replace: article_title_code, article_title
  assign alt_text = alt_text | replace: article_author_code, article_author
  assign alt_text = alt_text | replace: article_tags_code, article_tags

  assign alt_text = alt_text | replace: shop_name_code, shop_name
  assign alt_text = alt_text | replace: shop_domain_code, shop_domain
%}
<!-- - Liquid translation layer - end -->

{% if request.page_type == 'product' and settings.altText.productStatus %}
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const imageTags = document.querySelectorAll('img');
      imageTags.forEach((img) => {
        img.setAttribute('alt', '{{ alt_text }}');
      });
    });
  </script>
{% endif %}

{% if request.page_type == 'collection' and settings.altText.collectionStatus %}
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const imageTags = document.querySelectorAll('img');
      imageTags.forEach((img) => {
        img.setAttribute('alt', '{{ alt_text }}');
      });
    });
  </script>
{% endif %}
{% if request.page_type == 'article' and settings.altText.articleStatus %}
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const imageTags = document.querySelectorAll('img');
      imageTags.forEach((img) => {
        img.setAttribute('alt', '{{ alt_text }}');
      });
    });
  </script>
{% endif %}
{% comment %}
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const cond = JSON.parse('{{ settings.altText.lazyLoadImages }}');
      const imageTags = document.querySelectorAll('img');
      imageTags.forEach((img) => {
        if (cond) img.setAttribute('loading', 'lazy');
        else img.removeAttribute('loading');
      });
    });
  </script>
{% endcomment %}
<script>
  console.log('Image optimizer snippet loaded!');
</script>
<img
  {% if settings.altText.lazyLoadImages %}
    loading="lazy"
  {% else %}
    loading="eager"
  {% endif %}
>
{% comment %}
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const productImages = document.querySelectorAll('img'); // Collect all images
      productImages.forEach(function (image) {
        const imageUrl = image.src;
        console.log('Image URL: ' + imageUrl);
        console.log('Shop url: ' + '{{ shop.url }}', `secure url: {{ shop.secure_url }}`, `domain: {{ shop.domain }}`); // This is the shop URL
        // Now, you'll want to match this URL to a product
      });
    });
  </script>
{% endcomment %}
